{"remainingRequest":"D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\src\\views\\image\\components\\image-list.vue?vue&type=style&index=0&id=2b4453ea&scoped=true&lang=less&","dependencies":[{"path":"D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\src\\views\\image\\components\\image-list.vue","mtime":1606908413765},{"path":"D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\node_modules\\less-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoNCi5hY3Rpb24taGVhZCB7DQogIHBhZGRpbmctYm90dG9tOiAyMHB4Ow0KICBkaXNwbGF5OiBmbGV4Ow0KICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWJldHdlZW47DQp9DQoNCi5pbWFnZS1pdGVtIHsNCiAgcG9zaXRpb246IHJlbGF0aXZlOw0KfQ0KDQouaW1hZ2UtYWN0aW9uIHsNCiAgZm9udC1zaXplOiAyNXB4Ow0KICBkaXNwbGF5OiBmbGV4Ow0KICBqdXN0aWZ5LWNvbnRlbnQ6IHNwYWNlLWV2ZW5seTsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCiAgY29sb3I6ICNmZmY7DQogIGhlaWdodDogNDBweDsNCiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyMDQsIDIwNCwgMjA0LCAuNSk7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgYm90dG9tOiA0cHg7DQogIGxlZnQ6IDVweDsNCiAgcmlnaHQ6IDVweDsNCn0NCg0KLnNlbGVjdGVkIHsNCiAgYmFja2dyb3VuZDogdXJsKC4vc2VsZWN0ZWQucG5nKSBuby1yZXBlYXQ7DQogIGJhY2tncm91bmQtc2l6ZTogY292ZXI7DQogIHBvc2l0aW9uOiBhYnNvbHV0ZTsNCiAgbGVmdDogMDsNCiAgcmlnaHQ6IDA7DQogIGJvdHRvbTogMDsNCiAgdG9wOiAwOw0KICBkaXNwbGF5OiBmbGV4Ow0KICBqdXN0aWZ5LWNvbnRlbnQ6IGNlbnRlcjsNCiAgYWxpZ24taXRlbXM6IGNlbnRlcjsNCn0NCg=="},{"version":3,"sources":["image-list.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAkQA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"image-list.vue","sourceRoot":"src/views/image/components","sourcesContent":["<template>\r\n  <div class=\"image-list\">\r\n    <div class=\"action-head\">\r\n      <el-radio-group\r\n        v-model=\"collect\"\r\n        size=\"mini\"\r\n        @change=\"loadImages(1)\"\r\n      >\r\n        <el-radio-button\r\n          :label=\"false\"\r\n        >全部</el-radio-button>\r\n        <el-radio-button\r\n          :label=\"true\"\r\n        >收藏</el-radio-button>\r\n      </el-radio-group>\r\n      <el-button\r\n        v-if=\"isShowAdd\"\r\n        size=\"mini\"\r\n        type=\"success\"\r\n        @click=\"dialogUploadVisible = true\"\r\n      >上传素材</el-button>\r\n    </div>\r\n    <!-- 素材列表 -->\r\n    <el-row :gutter=\"10\">\r\n      <el-col\r\n        :xs=\"12\"\r\n        :sm=\"6\"\r\n        :md=\"6\"\r\n        :lg=\"4\"\r\n        v-for=\"(img, index) in images\"\r\n        :key=\"index\"\r\n        class=\"image-item\"\r\n        @click.native=\"selected = index\"\r\n      >\r\n        <el-image\r\n          style=\"height: 100px\"\r\n          :src=\"img.url\"\r\n          fit=\"cover\"\r\n        ></el-image>\r\n        <div\r\n          class=\"selected\"\r\n          v-if=\"isShowSelected && selected === index\"\r\n        ></div>\r\n        <div v-if=\"isShowAction\" class=\"image-action\">\r\n          <!--\r\n            class 样式绑定\r\n             {\r\n                CSS类名: 布尔值\r\n             }\r\n             true：作用类名\r\n             false：不作用类名\r\n           -->\r\n          <el-button\r\n            type=\"warning\"\r\n            :icon=\"img.is_collected ? 'el-icon-star-on' : 'el-icon-star-off'\"\r\n            circle\r\n            size=\"small\"\r\n            @click=\"onCollect(img)\"\r\n            :loading=\"img.loading\"\r\n          ></el-button>\r\n          <el-button\r\n            size=\"small\"\r\n            type=\"danger\"\r\n            icon=\"el-icon-delete-solid\"\r\n            circle\r\n            :loading=\"img.loading\"\r\n            @click=\"onDelete(img)\"\r\n          ></el-button>\r\n          <!-- <i\r\n            :class=\"{\r\n              'el-icon-star-on': img.is_collected,\r\n              'el-icon-star-off': !img.is_collected\r\n            }\"\r\n            @click=\"onCollect(img)\"\r\n          ></i> -->\r\n          <!-- <i class=\"el-icon-delete-solid\"></i> -->\r\n          <!-- <el-button size=\"mini\" icon=\"el-icon-delete-solid\" circle></el-button> -->\r\n        </div>\r\n      </el-col>\r\n    </el-row>\r\n    <!-- /素材列表 -->\r\n\r\n    <!-- 数据分页 -->\r\n    <!--\r\n      分页数据改变以后，页码不会变化\r\n      它需要单独处理高亮的页码\r\n     -->\r\n    <el-pagination\r\n      background\r\n      layout=\"prev, pager, next\"\r\n      :total=\"totalCount\"\r\n      :page-size=\"pageSize\"\r\n      :current-page.sync=\"page\"\r\n      @current-change=\"onPageChange\"\r\n    >\r\n    </el-pagination>\r\n    <!-- /数据分页 -->\r\n\r\n    <el-dialog\r\n      title=\"上传素材\"\r\n      :visible.sync=\"dialogUploadVisible\"\r\n      :append-to-body=\"true\"\r\n    >\r\n      <!--\r\n        upload 组件本身就支持请求提交上传操作，说白了你使用它不用自己去发请求，它会自己发。\r\n        请求方法：默认就是 POST\r\n        请求路径：action，必须写完整路径\r\n        请求头：headers\r\n       -->\r\n      <el-upload\r\n        class=\"upload-demo\"\r\n        drag\r\n        action=\"http://ttapi.research.itcast.cn/mp/v1_0/user/images\"\r\n        :headers=\"uploadHeaders\"\r\n        name=\"image\"\r\n        multiple\r\n        :show-file-list=\"false\"\r\n        :on-success=\"onUploadSuccess\"\r\n      >\r\n        <i class=\"el-icon-upload\"></i>\r\n        <div class=\"el-upload__text\">将文件拖到此处，或<em>点击上传</em></div>\r\n        <div class=\"el-upload__tip\" slot=\"tip\">只能上传jpg/png文件，且不超过500kb</div>\r\n      </el-upload>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport {\r\n  getImages,\r\n  collectImage,\r\n  deleteImage\r\n} from '@/api/image'\r\n\r\nexport default {\r\n  name: 'ImageList',\r\n  components: {},\r\n  // 使用对象的方式定义 prop，更严谨，功能更丰富，强烈建议在项目中使用\r\n  // 参考文档：https://cn.vuejs.org/v2/guide/components-props.html#Prop-%E9%AA%8C%E8%AF%81\r\n  props: {\r\n    foo: {\r\n      type: Number,\r\n      // required: true,\r\n      default: 123\r\n    },\r\n    // 是否显示添加素材\r\n    isShowAdd: {\r\n      type: Boolean, // 布尔值\r\n      default: true // 默认值\r\n    },\r\n\r\n    // 是否显示图片下方的操作（收藏和删除）\r\n    isShowAction: {\r\n      type: Boolean,\r\n      default: true\r\n    },\r\n\r\n    isShowSelected: {\r\n      type: Boolean,\r\n      default: false\r\n    }\r\n  },\r\n  // 使用数组声明 prop，不建议，不够严谨，而且功能也不够强大，仅适合 demo 演示\r\n  // props: ['dsadsadsa'],\r\n  data () {\r\n    const user = JSON.parse(window.localStorage.getItem('user'))\r\n    return {\r\n      collect: false, // 默认查询全部素材列表\r\n      images: [], // 图片素材列表\r\n      dialogUploadVisible: false,\r\n      uploadHeaders: {\r\n        Authorization: `Bearer ${user.token}`\r\n      },\r\n      totalCount: 0, // 总数据条数\r\n      pageSize: 20, // 每页大小\r\n      page: 1, // 当前页码\r\n      selected: null // 选中的索引\r\n    }\r\n  },\r\n  computed: {},\r\n  watch: {},\r\n  created () {\r\n    // 页面初始化加载第 1 页数据\r\n    this.loadImages(1)\r\n  },\r\n  mounted () {},\r\n  methods: {\r\n    loadImages (page = 1) {\r\n      // 重置高亮页码，防止数据和页码不对应\r\n      this.page = page\r\n      getImages({\r\n        collect: this.collect,\r\n        page,\r\n        per_page: this.pageSize\r\n      }).then(res => {\r\n        const results = res.data.data.results\r\n        results.forEach(img => {\r\n          // img 对象本来没有 loading 数据\r\n          // 我们这里收到的往里面添加该数据是用来控制每个收藏按钮的 loading 状态\r\n          img.loading = false\r\n        })\r\n        this.images = results\r\n        this.totalCount = res.data.data.total_count\r\n      })\r\n    },\r\n\r\n    // onCollectChange () {\r\n    //   this.loadImages(1)\r\n    // },\r\n\r\n    onUploadSuccess () {\r\n      // 关闭对话框\r\n      this.dialogUploadVisible = false\r\n\r\n      // 更新素材列表\r\n      this.loadImages(this.page)\r\n\r\n      this.$message({\r\n        type: 'success',\r\n        message: '上传成功'\r\n      })\r\n    },\r\n\r\n    onPageChange (page) {\r\n      this.loadImages(page)\r\n    },\r\n\r\n    onCollect (img) {\r\n      // 展示 loading\r\n      img.loading = true\r\n      collectImage(img.id, !img.is_collected).then(res => {\r\n        // 更新视图状态\r\n        img.is_collected = !img.is_collected\r\n        // 关闭 loading\r\n        img.loading = false\r\n      })\r\n      // if (img.is_collected) {\r\n      //   // 已收藏，取消收藏\r\n      //   collectImage(img.id, false)\r\n      // } else {\r\n      //   // 没有收藏，添加收藏\r\n      //   collectImage(img.id, true)\r\n      // }\r\n    },\r\n\r\n    onDelete (img) {\r\n      img.loading = true\r\n      deleteImage(img.id).then(res => {\r\n        // 重新加载数据列表\r\n        this.loadImages(this.page)\r\n        img.loading = false\r\n      })\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n.action-head {\r\n  padding-bottom: 20px;\r\n  display: flex;\r\n  justify-content: space-between;\r\n}\r\n\r\n.image-item {\r\n  position: relative;\r\n}\r\n\r\n.image-action {\r\n  font-size: 25px;\r\n  display: flex;\r\n  justify-content: space-evenly;\r\n  align-items: center;\r\n  color: #fff;\r\n  height: 40px;\r\n  background-color: rgba(204, 204, 204, .5);\r\n  position: absolute;\r\n  bottom: 4px;\r\n  left: 5px;\r\n  right: 5px;\r\n}\r\n\r\n.selected {\r\n  background: url(./selected.png) no-repeat;\r\n  background-size: cover;\r\n  position: absolute;\r\n  left: 0;\r\n  right: 0;\r\n  bottom: 0;\r\n  top: 0;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n}\r\n</style>\r\n"]}]}