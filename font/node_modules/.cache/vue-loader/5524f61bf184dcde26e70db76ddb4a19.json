{"remainingRequest":"D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\src\\views\\publish\\components\\upload-cover.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\src\\views\\publish\\components\\upload-cover.vue","mtime":1607394431726},{"path":"D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\node_modules\\babel-loader\\lib\\index.js","mtime":315532800000},{"path":"D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\webLearn\\Vue\\黑马头条\\后台\\publish-admin-test\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCiAgaW1wb3J0IEltYWdlTGlzdCBmcm9tICdAL3ZpZXdzL2ltYWdlL2NvbXBvbmVudHMvaW1hZ2UtbGlzdCcKICBpbXBvcnQgeyB1cGxvYWRJbWFnZSB9IGZyb20gJ0AvYXBpL2ltYWdlJwpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogJ1VwbG9hZENvdmVyJywKICBwcm9wczogWyd2YWx1ZSddLAogIC8vIHByb3BzOiBbJ2NvdmVyLWltYWdlJ10sCiAgY29tcG9uZW50czogewogICAgSW1hZ2VMaXN0CiAgfSwKICBkYXRhICgpIHsKICAgIHJldHVybiB7CiAgICAgIGRpYWxvZ1Zpc2libGUgOmZhbHNlLAogICAgICBhY3RpdmVOYW1lOiAnc2Vjb25kJwogICAgfQogIH0sCiAgY29tcHV0ZWQ6IHsKICB9LAogIGNyZWF0ZWQoKSB7fSwKICBtb3VudGVkKCkge30sCiAgd2F0Y2g6IHsKICB9LAogIG1ldGhvZHM6IHsKICAgIHNob3dDb3ZlclNlbGVjdCgpIHsKICAgICAgdGhpcy5kaWFsb2dWaXNpYmxlID0gdHJ1ZQogICAgfSwKICAgIG9uRmlsZUNoYW5nZSgpIHsKICAgICAgLy8g6I635Y+W5paH5Lu25a+56LGhCiAgICAgIGNvbnN0IGZpbGUgPSB0aGlzLiRyZWZzLmZpbGUuZmlsZXNbMF0KICAgICAgY29uc3QgYmxvYiA9IHdpbmRvdy5VUkwuY3JlYXRlT2JqZWN0VVJMKGZpbGUpCiAgICAgIHRoaXMuJHJlZnNbJ3ByZXZpZXctaW1hZ2UnXS5zcmMgPSBibG9iCiAgICAgIC8v6Ziy5q2iIOeUqOaIt+mAieaLqeWQjOS4gOS4quaWh+S7tuS4jeinpuWPkWNoYW5nZeS6i+S7tgogICAgICAvL3RoaXMuJHJlZnMuZmlsZS52YWx1ZSA9ICcnCiAgICB9LAogICAgb25Db3ZlckNvbmZpcm0oKSB7CiAgICAgIC8vIOWmguaenCB0YWIg5piv5LiK5Lyg5Zu+54mH77yM5bm25LiUIGlucHV0LWZpbGUg5pyJ6YCJ5oup55qE5paH5Lu277yM5omN5omn6KGM5LiK5Lyg5Zu+54mH55qE5pON5L2cCiAgICAgIGlmICh0aGlzLmFjdGl2ZU5hbWUgPT09ICdzZWNvbmQnKSB7CiAgICAgICAgY29uc3QgZmlsZSA9IHRoaXMuJHJlZnMuZmlsZS5maWxlc1swXQogICAgICAgIGlmICghZmlsZSkgewogICAgICAgICAgdGhpcy4kbWVzc2FnZSgn6K+36YCJ5oup5paH5Lu2JykKICAgICAgICAgIHJldHVybgogICAgICAgIH0KICAgICAgICAvLyDmiafooYzkuIrkvKDmlofku7bnmoTmk43kvZwKICAgICAgICBjb25zdCBmZCA9IG5ldyBGb3JtRGF0YSgpCiAgICAgICAgZmQuYXBwZW5kKCdpbWFnZScsIGZpbGUpCgogICAgICAgIHVwbG9hZEltYWdlKGZkKS50aGVuKHJlcyA9PiB7CiAgICAgICAgICAvLyDlhbPpl63lvLnlh7rlsYIKICAgICAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgICAvLyDlsZXnpLrkuIrkvKDnmoTlm77niYcKICAgICAgICAgIHRoaXMuJHJlZnNbJ2NvdmVyLWltYWdlJ10uc3JjID0gcmVzLmRhdGEuZGF0YS51cmwKCiAgICAgICAgICAvLyDlsIblm77niYflnLDlnYDlj5HpgIHnu5nniLbnu4Tku7YKICAgICAgICAgIC8vdGhpcy4kZW1pdCgndXBkYXRlLWNvdmVyJywgcmVzLmRhdGEuZGF0YS51cmwpCiAgICAgICAgICB0aGlzLiRlbWl0KCdpbnB1dCcsIHJlcy5kYXRhLmRhdGEudXJsKQogICAgICAgICAgLy8gdGhpcy4kZW1pdCgndXBkYXRlLWNvdmVyJywgcmVzLmRhdGEuZGF0YS51cmwpCiAgICAgICAgfSkKICAgICAgfWVsc2UgaWYgKHRoaXMuYWN0aXZlTmFtZSA9PT0gJ2ZpcnN0Jyl7CiAgICAgICAgLy8g6L+Y5pyJ5LiA56eN57uE5Lu26YCa5L+h5pa55byP77ya54i257uE5Lu25Y+v5Lul55u05o6l6K6/6Zeu5a2Q57uE5Lu25Lit55qE5pWw5o2uCiAgICAgICAgY29uc3QgaW1hZ2VMaXN0ID0gdGhpcy4kcmVmc1snaW1hZ2UtbGlzdCddCiAgICAgICAgY29uc3Qgc2VsZWN0ZWQgPSBpbWFnZUxpc3Quc2VsZWN0ZWQKICAgICAgICBpZiAoc2VsZWN0ZWQgPT09IG51bGwpIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2UoJ+ivt+mAieaLqeWwgemdouWbvueJhycpCiAgICAgICAgICByZXR1cm4KICAgICAgICB9CgogICAgICAgIC8vIOWFs+mXreWvueivneahhgogICAgICAgIHRoaXMuZGlhbG9nVmlzaWJsZSA9IGZhbHNlCiAgICAgICAgLy8g5L+u5pS554i257uE5Lu257uR5a6a5pWw5o2uCiAgICAgICAgdGhpcy4kZW1pdCgnaW5wdXQnLCBpbWFnZUxpc3QuaW1hZ2VzW3NlbGVjdGVkXS51cmwpCiAgICAgIH0KICAgIH0KICB9LAogIGZpbHRlcnM6IHsKICAgIGZuTmFtZTogZnVuY3Rpb24gKHZhbHVlKSB7CiAgICAgIHJldHVybiB2YWx1ZQogICAgfQogIH0KfQo="},{"version":3,"sources":["upload-cover.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAiDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"upload-cover.vue","sourceRoot":"src/views/publish/components","sourcesContent":["<template>\r\n  <div class=\"upload-cover\" @click=\"showCoverSelect\">\r\n    <div class=\"cover-wrap\">\r\n      <img\r\n        class=\"cover-image\"\r\n        ref=\"cover-image\"\r\n        :src=\"value\"\r\n      >\r\n    </div>\r\n\r\n    <el-dialog\r\n      title=\"选择封面\"\r\n      :visible.sync=\"dialogVisible\"\r\n      append-to-body\r\n    >\r\n      <el-tabs v-model=\"activeName\" type=\"card\">\r\n        <el-tab-pane label=\"素材库\" name=\"first\">\r\n          <image-list\r\n            :is-show-add=\"false\"\r\n            :is-show-action=\"false\"\r\n            is-show-selected\r\n            :foo=\"666\"\r\n            ref=\"image-list\"\r\n          />\r\n        </el-tab-pane>\r\n        <el-tab-pane label=\"上传图片\" name=\"second\">\r\n          <input\r\n            type=\"file\"\r\n            @change=\"onFileChange\"\r\n            ref=\"file\"\r\n          >\r\n          <img\r\n            width=\"100\"\r\n            ref=\"preview-image\"\r\n          >\r\n        </el-tab-pane>\r\n      </el-tabs>\r\n      <span slot=\"footer\" class=\"dialog-footer\">\r\n        <el-button @click=\"dialogVisible = false\">取 消</el-button>\r\n        <el-button\r\n          type=\"primary\"\r\n          @click=\"onCoverConfirm\"\r\n        >确 定</el-button>\r\n      </span>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import ImageList from '@/views/image/components/image-list'\r\n  import { uploadImage } from '@/api/image'\r\nexport default {\r\n  name: 'UploadCover',\r\n  props: ['value'],\r\n  // props: ['cover-image'],\r\n  components: {\r\n    ImageList\r\n  },\r\n  data () {\r\n    return {\r\n      dialogVisible :false,\r\n      activeName: 'second'\r\n    }\r\n  },\r\n  computed: {\r\n  },\r\n  created() {},\r\n  mounted() {},\r\n  watch: {\r\n  },\r\n  methods: {\r\n    showCoverSelect() {\r\n      this.dialogVisible = true\r\n    },\r\n    onFileChange() {\r\n      // 获取文件对象\r\n      const file = this.$refs.file.files[0]\r\n      const blob = window.URL.createObjectURL(file)\r\n      this.$refs['preview-image'].src = blob\r\n      //防止 用户选择同一个文件不触发change事件\r\n      //this.$refs.file.value = ''\r\n    },\r\n    onCoverConfirm() {\r\n      // 如果 tab 是上传图片，并且 input-file 有选择的文件，才执行上传图片的操作\r\n      if (this.activeName === 'second') {\r\n        const file = this.$refs.file.files[0]\r\n        if (!file) {\r\n          this.$message('请选择文件')\r\n          return\r\n        }\r\n        // 执行上传文件的操作\r\n        const fd = new FormData()\r\n        fd.append('image', file)\r\n\r\n        uploadImage(fd).then(res => {\r\n          // 关闭弹出层\r\n          this.dialogVisible = false\r\n          // 展示上传的图片\r\n          this.$refs['cover-image'].src = res.data.data.url\r\n\r\n          // 将图片地址发送给父组件\r\n          //this.$emit('update-cover', res.data.data.url)\r\n          this.$emit('input', res.data.data.url)\r\n          // this.$emit('update-cover', res.data.data.url)\r\n        })\r\n      }else if (this.activeName === 'first'){\r\n        // 还有一种组件通信方式：父组件可以直接访问子组件中的数据\r\n        const imageList = this.$refs['image-list']\r\n        const selected = imageList.selected\r\n        if (selected === null) {\r\n          this.$message('请选择封面图片')\r\n          return\r\n        }\r\n\r\n        // 关闭对话框\r\n        this.dialogVisible = false\r\n        // 修改父组件绑定数据\r\n        this.$emit('input', imageList.images[selected].url)\r\n      }\r\n    }\r\n  },\r\n  filters: {\r\n    fnName: function (value) {\r\n      return value\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped lang=\"less\">\r\n  .cover-wrap {\r\n    width: 150px;\r\n    height: 120px;\r\n    border: 1px solid #000;\r\n    .cover-image {\r\n      height: 120px;\r\n      max-width: 100%;\r\n    }\r\n  }\r\n</style>\r\n"]}]}